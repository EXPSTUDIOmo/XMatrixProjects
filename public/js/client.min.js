let currentScene=0,isPlaying=!1;const connectionStatus=document.getElementById("connectionStatus"),videoHint=document.getElementById("video_tab_hint"),videoScreen=document.getElementById("videoscreen"),avatarSecretary=document.getElementById("waitavatar_secretary"),avatarSzusi=document.getElementById("waitavatar_szusi"),avatarFan=document.getElementById("waitavatar_fan"),avatarKarl=document.getElementById("waitavatar_karl"),avatarAndre=document.getElementById("waitavatar_andre"),WAIT_AVATARS=[avatarSecretary,avatarSzusi,avatarFan,avatarKarl,avatarAndre];let onWaitScreen=!1,avatarIndex=0,lastAvatarIndex=-1,avatarTimeout;function setOnWaitScreen(e){if(e!=onWaitScreen){if(onWaitScreen=e)showNextAvatar(),avatarTimeout=setInterval(showNextAvatar,12e3);else for(let t of(clearInterval(avatarTimeout),WAIT_AVATARS))t.classList.remove("screen-avatar-active")}}function showNextAvatar(){WAIT_AVATARS[avatarIndex].classList.add("screen-avatar-active"),-1!=lastAvatarIndex&&WAIT_AVATARS[lastAvatarIndex].classList.remove("screen-avatar-active"),lastAvatarIndex=avatarIndex,avatarIndex=(avatarIndex+1)%WAIT_AVATARS.length}const connectBtn=document.getElementById("connect_btn_container"),incomingchat=document.getElementById("incomingchat"),content=document.getElementById("content"),chatcontent=document.getElementById("chatcontent"),chatscreen=document.getElementById("chatscreen"),videoscreen=document.getElementById("videoscreen"),waitscreen=document.getElementById("waitscreen"),pulses=document.getElementsByClassName("pulse"),pulses_play=document.getElementsByClassName("pulse_play"),video_1=document.getElementById("video_1"),video_2=document.getElementById("video_2"),VIDEO_SOURCES_POSES=["scaled_Zsuzsi_1_video.mp4","scaled_Secretary_2_video.mp4","scaled_Fan_1_video.mp4","scaled_Karl_2_video.mp4","scaled_Andrei_2_video.mp4",],VIDEO_SOURCES_DACH=["scaled_Dach_1_video.mp4","scaled_Dach_3_video.mp4","scaled_Dach_4_video.mp4","scaled_Dach_5_video.mp4","scaled_Dach_6_video.mp4","scaled_Baustelle_Pieta_Orbit.mp4"];let VIDEOS_SCENE_1=[],VIDEOS_SCENE_3=[],numVideosInScene=VIDEO_SOURCES_POSES.length;videoscreen.addEventListener("click",()=>{playVideo(),videoHint.style.display="none"});const noSleep=new NoSleep;let wakeLock=null;const requestWakeLock=async()=>{try{wakeLock=await navigator.wakeLock.request("screen")}catch(e){console.error(`${e.name}, ${e.message}`)}},socket=io({reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4,query:{admin:!1}});socket.on("connected",e=>{loadSounds(e.voice),connectionStatus.innerHTML="CONNECTED"});let pingTimeout,dummyCounter=0;function loadScene(e,t=0){if(currentScene!=e&&isConnected)switch(currentScene=e,stopAllSound(),inFadeAnimation&&(content.classList.remove("fadeOutContent"),clearTimeout(fadeOutTimeOut),clearTimeout(fadeInTimeOut),clearTimeout(chatFadeTimeout),inFadeAnimation=!1),e){case 0:showWaitScreen(),stopAllSound(),stopVideos(),resetChat(),IsInChat=!1,isPlaying=!1;break;case 1:preloadVideo(1),numVideosInScene=VIDEO_SOURCES_POSES.length,waitscreen.style.display="none",chatscreen.style.display="none",incomingchat.style.display="none",showVideoScreen(),IsInChat=!1,playVideo(),playSound(0,t),isPlaying=!0;break;case 2:waitscreen.style.display="none",videoscreen.style.display="none",chatscreen.style.display="none",resetChat(),preloadVideo(3),showIncomingChat(),displayChat(t),playSound(1,t),isPlaying=!0;break;case 3:waitscreen.style.display="none",chatscreen.style.display="none",incomingchat.style.display="none",preloadVideo(3),showVideoScreen(),IsInChat=!1,numVideosInScene=VIDEO_SOURCES_DACH.length,playSound(2,t),playVideo(),isPlaying=!0}}socket.on("pong",()=>{dummyCounter+=1}),socket.on("activation",e=>{currentScene!=e.scene&&isConnected&&(preloadVideo(e.scene),loadScene(e.scene,e.time))}),socket.on("disconnect",e=>{isConnected=!1,connectionStatus.innerHTML="DISCONNECTED! <p class='text-2xl'>Try reloading the page</p>"}),socket.on("start",e=>{loadScene(e)}),socket.on("stop",()=>{0!=currentScene&&loadScene(0),stopAllSound()}),socket.on("silent",()=>{console.log("silent")});let inFadeAnimation=!1,fadeOutTimeOut,fadeInTimeOut;function showWaitScreen(){isPlaying?(inFadeAnimation=!0,content.classList.add("fadeOutContent"),fadeOutTimeOut=setTimeout(()=>{videoscreen.style.display="none",video_1.classList.add("hidden"),video_2.classList.add("hidden"),incomingchat.style.display="none",chatscreen.style.display="none",waitscreen.style.display="flex",setOnWaitScreen(!0)},2200),fadeInTimeOut=setTimeout(()=>{content.classList.remove("fadeOutContent"),inFadeAnimation=!1},4500)):isPlaying||inFadeAnimation||(videoscreen.style.display="none",video_1.classList.add("hidden"),video_2.classList.add("hidden"),incomingchat.style.display="none",chatscreen.style.display="none",waitscreen.style.display="flex",setOnWaitScreen(!0))}function showVideoScreen(){videoscreen.style.display="flex",videoHint.style.display="block",videoHint.classList.add("video_hint_anim"),setTimeout(()=>{videoHint.classList.remove("video_hint_anim")},4100)}let SOUNDS=[];function playSound(e,t=0){SOUNDS[e].seek(t),SOUNDS[e].play()}let currentlyActivePlayer=1,currentVideo=0;function preloadVideo(e){1===e||0===e?video_1.src=`https://freedomcdn.fra1.cdn.digitaloceanspaces.com/${VIDEO_SOURCES_POSES[0]}`:video_1.src=`https://freedomcdn.fra1.cdn.digitaloceanspaces.com/${VIDEO_SOURCES_DACH[0]}`,currentVideo=0,currentlyActivePlayer=0}function playVideo(){let e=0===currentlyActivePlayer?video_1:video_2,t=0===currentlyActivePlayer?video_2:video_1;isPlayingVideo||e.classList.remove("hidden"),e.play().then(()=>{isPlayingVideo=!0,requestAnimationFrame(()=>{e.classList.remove("hidden"),t.classList.add("hidden"),t.pause()});let n=(currentVideo+1)%numVideosInScene,a=1===currentScene?`https://freedomcdn.fra1.cdn.digitaloceanspaces.com/${VIDEO_SOURCES_POSES[n]}`:`https://freedomcdn.fra1.cdn.digitaloceanspaces.com/${getRandomDachVideo()}`;t.src=a,t.load(),currentVideo=n,currentlyActivePlayer=0===currentlyActivePlayer?1:0}).catch(prepareNextVideoOnError)}function prepareNextVideoOnError(){let e=0===currentlyActivePlayer?video_2:video_1,t=(currentVideo+1)%numVideosInScene,n=1===currentScene?`/Videos/${VIDEO_SOURCES_POSES[t]}`:`/Videos/${getRandomDachVideo()}`;e.src=n,e.load(),currentVideo=t,currentlyActivePlayer=0===currentlyActivePlayer?1:0}video_1.onwaiting=function(){document.getElementById("video_loading").style.display="block"},video_1.onplaying=function(){document.getElementById("video_loading").style.display="none"},video_2.onwaiting=function(){document.getElementById("video_loading").style.display="block"},video_2.onplaying=function(){document.getElementById("video_loading").style.display="none"};let lastDachVideo=-1;function getRandomDachVideo(){let e=Math.floor(Math.random()*VIDEO_SOURCES_DACH.length);e===lastDachVideo&&(e=(e+1)%VIDEO_SOURCES_DACH.length);let t=VIDEO_SOURCES_DACH[e];return lastDachVideo=e,t}let isPlayingVideo=!1;function stopVideos(){video_1.pause(),video_2.pause(),isPlayingVideo=!1}function stopAllSound(){for(let e=0;e<SOUNDS.length;++e)SOUNDS[e].stop()}let loadTimeout;function loadSounds(e){loadSound(0,`https://freedomcdn.fra1.digitaloceanspaces.com/PNO_H_${e+1}.mp3`),loadSound(1,`https://freedomcdn.fra1.digitaloceanspaces.com/NOT_H_${e+1}.mp3`),loadSound(2,`https://freedomcdn.fra1.digitaloceanspaces.com/FLT_H_${e+1}.mp3`)}function loadSound(e,t,n=0,a=3){SOUNDS[e]=new Howl({src:[t],html5:!0,onload:function(){incrementSFLoaded()},onloaderror:function(s,i){n<a?loadSound(e,t,n+1,a):window.location.reload()}})}const SoundfilesToLoad=3;let soundfilesLoaded=0;function incrementSFLoaded(){3==++soundfilesLoaded&&(document.getElementById("loading_container").style.display="none",connectBtn.style.display="block")}let isConnected=!1;function goFullscreen(){!document.fullscreenElement&&(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen())}function detectMobile(){let e=navigator.userAgent;return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)}function enableNoSleep(){noSleep.enable()}connectBtn.onclick=()=>{!isConnected&&(isConnected=!0,goFullscreen(),socket.emit("activate"),document.getElementById("connect_btn").innerHTML="&#10003",pulses[0].style.animationIterationCount="1",pulses[1].style.animationIterationCount="1",setTimeout(()=>{document.getElementById("connect_btn").classList.add("grow")},750),setTimeout(()=>{document.getElementById("startscreen").style.display="none",document.getElementById("content").style.display="flex",setOnWaitScreen(!0)},1200),"wakeLock"in navigator?requestWakeLock():detectMobile()&&enableNoSleep())};let IsInChat=!1;function showIncomingChat(){document.getElementById("incomingchat").style.display="flex"}function hideChat(){document.getElementById("chatscreen").style.display="none",document.getElementById("waitscreen").style.display="flex"}incomingchat.addEventListener("click",()=>{document.getElementById("incomingchat").style.display="none",document.getElementById("chatscreen").style.display="block",IsInChat=!0});let ChatTimeouts=[],chatMessageIndex=0,waitTime=0,lastMessage,chatFadeTimeout;function resetChat(){if(inFadeAnimation)chatFadeTimeout=setTimeout(()=>{for(let e of(chatMessageIndex=0,ChatTimeouts))clearTimeout(e);chatcontent.innerHTML="",ChatTimeouts=[],waitTime=0},2e3);else{for(let e of(chatMessageIndex=0,ChatTimeouts))clearTimeout(e);chatcontent.innerHTML="",ChatTimeouts=[],waitTime=0}}function createChatMessage(e,t,n){let a=document.createElement("div");if(a.classList.add("chatmessage"),!t){let s=document.createElement("h1");s.classList.add("white-text"),s.classList.add("text-1xl"),s.classList.add("ml-2"),s.textContent="left"==e?"ZSUZSI":"KARL",a.appendChild(s)}let i=document.createElement("div");i.classList.add("white-background");let d=document.createElement("p");return d.innerHTML=n,d.classList.add("black-text"),d.classList.add("text-1xl"),"left"===e?(a.classList.add("mb-3"),i.classList.add("chatbubble_a")):(a.classList.add("mr-2"),a.classList.add("ml-auto"),i.classList.add("chatbubble_b")),i.appendChild(d),a.appendChild(i),a}function postChatMessage(e){chatcontent.appendChild(e),chatcontent.scrollTop=chatcontent.scrollHeight}function displayChat(e=0){chatStartOffset=e,scheduleChatMessage(0,"new","left",!1,"Miss you babe \uD83D\uDE18"),scheduleChatMessage(7,"new","right",!1,'<div class="dots"></div>'),scheduleChatMessage(7,"update","right",!1,"Zsuzsi?"),scheduleChatMessage(10,"new","left",!1,'<div class="dots"></div>'),scheduleChatMessage(6,"update","left",!1,"Last night was so \uD83D\uDC3D \uD83D\uDCA6 \uD83D\uDE39 \uD83D\uDE3B ❤️‍\uD83D\uDD25"),scheduleChatMessage(6,"new","right",!1,'<div class="dots"></div>'),scheduleChatMessage(5,"update","right",!1,"Ermmm…"),scheduleChatMessage(4,"new","left",!1,'<div class="dots"></div>'),scheduleChatMessage(2,"update","left",!1,"Why so cold?"),scheduleChatMessage(3,"new","left",!0," r u w her?"),scheduleChatMessage(3,"new","right",!1,'<div class="dots"></div>'),scheduleChatMessage(1,"update","right",!1,"Yes"),scheduleChatMessage(3,"new","left",!1,'<div class="dots"></div>'),scheduleChatMessage(2,"update","left",!1,"Love you babe ❤️"),scheduleChatMessage(3,"new","right",!1,'<div class="dots"></div>'),scheduleChatMessage(7,"update","right",!1,"Can’t wait to see you!"),scheduleChatMessage(5,"new","left",!1,'<div class="dots"></div>'),scheduleChatMessage(3,"update","left",!1,"Get rid of her and come here at once \uD83E\uDDDC\uD83C\uDFFB‍♂️ \uD83E\uDDDC\uD83C\uDFFB‍♂️ \uD83E\uDDDC\uD83C\uDFFB‍♂️"),scheduleChatMessage(4,"new","right",!1,'<div class="dots"></div>'),scheduleChatMessage(10,"update","right",!1,"According to the scientific research, people using emoticons are emotionally unbalanced"),scheduleChatMessage(5,"new","left",!1,"Wtf!!"),scheduleChatMessage(5,"new","right",!1,'<div class="dots"></div>'),scheduleChatMessage(4,"update","right",!1,"This is Fan, by the way. Karl forgot his phone \uD83D\uDE3E"),scheduleChatMessage(5,"new","left",!1,'<div class="dots"></div>'),scheduleChatMessage(6,"update","left",!1,"&nbsp"),scheduleChatMessage(3,"new","left",!0,"&nbsp;&nbsp;&nbsp;&nbsp;"),scheduleChatMessage(1,"new","left",!0,"&nbsp;&nbsp;&nbsp;&nbsp;"),scheduleChatMessage(2,"new","left",!0,'<div class="dots"></div>'),scheduleChatMessage(5,"update","left",!0,"Oh"),scheduleChatMessage(4,"new","left",!0,"Damn"),scheduleChatMessage(2,"new","left",!0,'<div class="dots"></div>'),scheduleChatMessage(4,"update","left",!0,"I thought I was typing Alex…"),scheduleChatMessage(5,"new","right",!1,"\uD83D\uDD95\uD83C\uDFFB!!!")}let chatStartOffset=0;function scheduleChatMessage(e,t,n,a,s){let i=Math.max(0,(waitTime+=e)-chatStartOffset);if("new"==t){let d=createChatMessage(n,a,s);ChatTimeouts[chatMessageIndex]=setTimeout(()=>{postChatMessage(d)},1e3*i),chatMessageIndex++,lastMessage=d}else ChatTimeouts[chatMessageIndex]=setTimeout(()=>{document.querySelector("#chatcontent > div:last-child").querySelector("p").innerHTML=s,chatcontent.scrollTop=chatcontent.scrollHeight},1e3*i),chatMessageIndex++}